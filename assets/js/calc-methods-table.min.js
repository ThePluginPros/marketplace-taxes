!function(a,c,d,r){a(function(){var s=a(".wcv-taxes-methods"),e=a(".wcv-taxes-methods-rows"),t=d.template("wcv-taxes-method-row"),n=d.template("wcv-taxes-method-row-blank"),o=Backbone.Model.extend({methods:[],setMethods:function(e){this.set("methods",e),this.trigger("change:methods")}}),i=new(Backbone.View.extend({rowTemplate:t,initialize:function(){this.listenTo(this.model,"change:methods",this.render),a(document.body).on("click",".wcv-taxes-configure-method",{view:this},this.onConfigureMethod),a(document.body).on("wc_backbone_modal_response",this.onConfigureMethodSubmitted)},block:function(){a(this.el).block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){a(this.el).unblock()},render:function(){var e=_.indexBy(this.model.get("methods"),"id"),o=this;this.$el.empty(),this.unblock(),_.size(e)?a.each(e,function(e,t){"yes"==t.enabled?t.enabled_icon='<span class="status-enabled">'+c.strings.yes+"</span>":t.enabled_icon='<span class="status-disabled">'+c.strings.no+"</span>",o.$el.append(o.rowTemplate(t))}):o.$el.append(n)},initTips:function(){jQuery(".sf-tips").tooltip({animation:!0,html:!0,delay:{show:300,hide:100}})},onConfigureMethod:function(e){var t=a(this).closest("tr").data("id"),o=e.data.view,s=o.model,n=_.indexBy(s.get("methods"),"id")[t];if(!n.settings_html)return!0;e.preventDefault(),a(this).WCBackboneModal({template:"wcv-modal-calc-method-settings",variable:n,data:n}),o.initTips()},onConfigureMethodSubmitted:function(e,t,o){"wcv-modal-calc-method-settings"===t&&(i.block(),a.post(r+(0<r.indexOf("?")?"&":"?")+"action=wcv_taxes_save_calc_method",{wcv_taxes_save_calc_method_nonce:c.wcv_taxes_save_calc_method_nonce,id:o.id,data:o},function(e,t){"success"===t&&e.success?(s.parent().find("#woocommerce_errors").remove(),0<e.data.errors.length?i.showErrors(e.data.errors):i.model.setMethods(e.data.methods)):(window.alert(c.strings.save_failed),i.unblock())},"json"))},showErrors:function(e){var o='<div id="woocommerce_errors" class="error notice is-dismissible">';a(e).each(function(e,t){o=o+"<p>"+t+"</p>"}),o+="</div>",s.before(o)}}))({model:new o({methods:c.methods}),el:e});i.render()})}(jQuery,wcv_calc_methods_localize_script,wp,ajaxurl);