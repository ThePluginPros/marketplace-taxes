!function(a,o){a(function(){var t=wp.template("tfm-category-row"),e=Backbone.View.extend({rowTemplate:t,input:null,readout:null,defaultLabel:!1,initialize:function(){this.input=this.$el.siblings(".tfm-category-input"),this.readout=this.$el.siblings(".tfm-selected-category"),1===this.$el.data("is-bulk")?this.defaultLabel=o.strings.no_change:1===this.$el.data("is-variation")?this.defaultLabel=o.strings.same_as_parent:this.defaultLabel=o.strings.none,this.$el.click({view:this},this.openModal),this.$el.siblings(".tfm-reset-category").click({view:this},this.resetCategory)},render:function(){this.selectCategory(this.input.val())},bindEvents:function(){a(document.body).on("click",".tfm-select-done",{view:this},this.updateSelection),a(document.body).on("wc_backbone_modal_response",{view:this},this.completeSelection)},unbindEvents:function(){a(document.body).off("click",".tfm-select-done",this.updateSelection),a(document.body).off("wc_backbone_modal_response",this.completeSelection)},openModal:function(t){var e=t.data.view;t.preventDefault(),a(this).SSTBackboneModal({template:"tfm-category-select-modal"}),e.bindEvents(),e.initModal()},initModal:function(){var e=this,i=a(".tfm-category-list");i.empty(),_.each(o.category_list,function(t){i.append(e.rowTemplate(t))}),a(".tfm-category-search").hideseek()},updateSelection:function(t){var e=a(t.target).closest("tr");a('input[name="category"]').val(e.data("id")),a("#btn-ok").trigger("click")},completeSelection:function(t,e,i){"tfm-category-select-modal"===e&&(t.data.view.selectCategory(i.category),t.data.view.unbindEvents())},selectCategory:function(t){var e=_.indexBy(o.category_list,"product_tax_code");if(""===t)this.readout.text(this.defaultLabel);else{var i=e[t];this.readout.text(i.name+" ("+i.product_tax_code+")")}this.input.val(t).trigger("change")},resetCategory:function(t){t.data.view.selectCategory("")}});function i(){a(".tfm-select-category:not(.initialized)").each(function(){new e({el:a(this)}).render(),a(this).addClass("initialized")})}i(),a("#woocommerce-product-data").on("woocommerce_variations_loaded",i),a("#wcv_variable_product_options").on("wcv_variations_added",i)})}(jQuery,tfm_category_select_data);