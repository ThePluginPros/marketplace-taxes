!function(o,t,a){"use strict";o.fn.SSTBackboneModal=function(t){return this.each(function(){new o.SSTBackboneModal(o(this),t)})},o.SSTBackboneModal=function(t,e){var a=o.extend({},o.SSTBackboneModal.defaultOptions,e);a.template&&new o.SSTBackboneModal.View({target:a.template,string:a.variable,callback:a.callback})},o.SSTBackboneModal.defaultOptions={template:"",variable:{},callback:void 0},o.SSTBackboneModal.View=t.View.extend({tagName:"div",id:"wc-backbone-modal-dialog",_target:void 0,_string:void 0,_callback:void 0,events:{"click .modal-close":"closeButton","click #btn-ok":"addButton","touchstart #btn-ok":"addButton",keydown:"keyboardActions"},resizeContent:function(){var t=o(".wc-backbone-modal-content").find("article"),e=.75*o(window).height();t.css({"max-height":e+"px"})},initialize:function(t){var e=this;this._target=t.target,this._string=t.string,this._callback=t.callback,a.bindAll(this,"render"),this.render(),o(window).resize(function(){e.resizeContent()})},render:function(){var t=wp.template(this._target);this.$el.attr("tabindex","0").append(t(this._string)),o(document.body).css({overflow:"hidden"}).append(this.$el),this.resizeContent(),o(document.body).trigger("init_tooltips"),o(document.body).trigger("wc_backbone_modal_loaded",this._target)},closeButton:function(t){t.preventDefault(),o(document.body).trigger("wc_backbone_modal_before_remove",this._target),this.undelegateEvents(),o(document).off("focusin"),o(document.body).css({overflow:"auto"}),this.remove(),o(document.body).trigger("wc_backbone_modal_removed",this._target)},addButton:function(t){this._callback&&!this._callback(t,this._target,this.getFormData())||(o(document.body).trigger("wc_backbone_modal_response",[this._target,this.getFormData()]),this.closeButton(t))},getFormData:function(){var a={};return o(document.body).trigger("wc_backbone_modal_before_update",this._target),o.each(o("form",this.$el).serializeArray(),function(t,e){-1!==e.name.indexOf("[]")?(e.name=e.name.replace("[]",""),a[e.name]=o.makeArray(a[e.name]),a[e.name].push(e.value)):a[e.name]=e.value}),a},keyboardActions:function(t){var e=t.keyCode||t.which;13!==e||t.target.tagName&&("input"===t.target.tagName.toLowerCase()||"textarea"===t.target.tagName.toLowerCase())||this.addButton(t),27===e&&this.closeButton(t)}})}(jQuery,Backbone,_);